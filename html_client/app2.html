<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Donut</title>
    </head>
    <body>
        <div style="width: 50%; margin: auto;">
            <canvas id="myChart" style="height: 600px !important;"></canvas>
        </div>
        
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        
        <script>
            // consumo de nuestra APIRest
            fetch("http://localhost:3000/api/v1/randomAPI/credit_cards/20")
                .then(response => response.json())
                .then(responseJSON => {
                    // Pintamos en el gráfico la cantidad de tarjetas por tipo
                    const cardsArray = responseJSON.credit_cards.map(credit_card => credit_card.credit_card_type);

                    const cardsSinRep = cardsArray.filter((credit_type, index) => {
                        cardsArray.indexOf(credit_type) === index
                    });

                    // Valores
                    const valores = [];
                    for (const key of cardsSinRep) {
                        valores.push(responseJSON.credit_cards.filter(credit_card => credit_card.credit_card_type === key)).length
                    }

                    // Obtenim el context del canvas
                    const ctx = document.getElementById('myChart');                        

                    new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: cardsSinRep,
                        datasets: [{
                            label: '# Credit cards',
                            data: valores,
                            backgroundColor: 
                        [
                                'red',
                                'blue',
                                'green',
                                'yellow',
                                'black',
                                'orange',
                                'brown',
                                'grey',
                                'pink',
                                'lightblue'
                            ]
                        }]
                    }
                });
            })
            .catch(err => alert("Error 500. Error en el servidor intentélo más tarde!"))
        </script>
        
    </body>
</html>